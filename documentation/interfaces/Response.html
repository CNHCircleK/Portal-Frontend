<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>portal documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/material.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">portal documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>Response</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/services/api.service.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#auth">auth</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#error">error</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#result">result</a>
                                </li>
                                <li>
                                        <a href="#success">success</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#warnings">warnings</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="auth"></a>
                                        <span class="name"><b>auth</b><a href="#auth"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>auth:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="error"></a>
                                        <span class="name"><b>error</b><a href="#error"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>error:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="result"></a>
                                        <span class="name"><b>result</b><a href="#result"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>result:     <code>T</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>T</code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="success"></a>
                                        <span class="name"><b>success</b><a href="#success"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>success:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="warnings"></a>
                                        <span class="name"><b>warnings</b><a href="#warnings"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>warnings:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@angular/core&#x27;;
import { Observable, BehaviorSubject, of, zip, forkJoin } from &#x27;rxjs&#x27;;
import { defaultIfEmpty, concatMap, map, tap, filter, catchError, first, last } from &#x27;rxjs/operators&#x27;;
import { HttpClient, HttpHeaders, HttpParams } from &#x27;@angular/common/http&#x27;;
import HttpConfig from &#x27;@env/api_config&#x27;;
import { Cerf, Mrf, User, Member } from &#x27;@core/models&#x27;;
import { AuthService } from &#x27;@core/authentication/auth.service&#x27;;
import * as moment from &#x27;moment&#x27;;

interface Response&lt;T&gt; {
	success: boolean,
	auth: boolean,
	error?: string,
	warnings?: string,
	result?: T
}

// Any and all api calls go through here (except end-to-end authentication). Previously data.service.ts
// References: https://itnext.io/dont-clone-back-end-models-in-angular-f7a749bdc1b0
// 				https://medium.com/@joshblf/dynamic-nested-reactive-forms-in-angular-654c1d4a769a
@Injectable( {providedIn: &#x27;root&#x27; })
export class ApiService {

	constructor(private http: HttpClient, private authService: AuthService) {
		this.authService.getUserObservable().subscribe(user &#x3D;&gt; this.user&#x3D;user);
	}

	user: User;

	mrfState: Mrf;
	mrfFormState;
	mrfTabState: string;

	resetData()	// this goes into auth probably
	{
		// this.localStorage.clear().subscribe(()&#x3D;&gt;{});  // removes token also
	}


	getCerf(id: string) {
		return this.http.get&lt;Response&lt;Cerf&gt;&gt;(HttpConfig.baseUrl + &#x27;/events/&#x27; + id);
	}
	getMyCerfList() {
		if(!this. user) return of(null);
		return this.http.get&lt;Response&lt;Cerf[]&gt;&gt;(HttpConfig.baseUrl + &#x27;/members/&#x27; + this.user._id + &#x27;/events&#x27;);
		// it is not the service&#x27;s concern to clean up the data for the app to consume (e.g. reading &#x27;success&#x27; or returning [])
	}
	getPendingCerfs() {
		if(!this.user) return of(null);
		let params &#x3D; new HttpParams().set(&#x27;status&#x27;, &#x27;1&#x27;);
		return this.http.get&lt;Response&lt;Cerf[]&gt;&gt;(HttpConfig.baseUrl + &#x27;/clubs/&#x27; + this.user.club_id + &#x27;/events&#x27;, { params: params } );
		// This returns all. Endpoint to get it for specific month? Or we can filter and split up, but inefficient
	}

	updateCerf(data: Cerf) {
		return this.http.patch&lt;Response&lt;void&gt;&gt;(HttpConfig.baseUrl + &quot;/events/&quot; + data._id, data).pipe(tap(res &#x3D;&gt; console.log(res)));;
		// TODO: cache-bust according to data._id
	}

	createNewCerf(data: Cerf) {
		return this.http.post&lt;Response&lt;string&gt;&gt;(HttpConfig.baseUrl + &quot;/events&quot;, data).pipe(tap(res &#x3D;&gt; console.log(res)));
		// TODO: Special cache handler since the user will access this new cerf through its id
		// or leave it to refresh get requests again
	}

	changeCerfStatus(id: string, action: string) {
		if(action &#x3D;&#x3D; &quot;SUBMIT&quot;) {
			return this.http.patch&lt;Response&lt;void&gt;&gt;(HttpConfig.baseUrl + &quot;/events/&quot; + id + &quot;/submit&quot;, {submit: true});
		} else if(action &#x3D;&#x3D; &quot;UNSUBMIT&quot;) {
			return this.http.patch&lt;Response&lt;void&gt;&gt;(HttpConfig.baseUrl + &quot;/events/&quot; + id + &quot;/submit&quot;, {submit: false});
		} else if(action &#x3D;&#x3D; &quot;CONFIRM&quot;) {
			return this.http.patch&lt;Response&lt;void&gt;&gt;(HttpConfig.baseUrl + &quot;/events/&quot; + id + &quot;/confirm&quot;, {confirm: true});
		} else if(action &#x3D;&#x3D; &quot;UNCONFIRM&quot;) {
			return this.http.patch&lt;Response&lt;void&gt;&gt;(HttpConfig.baseUrl + &quot;/events/&quot; + id + &quot;/confirm&quot;, {confirm: false});
		}

		return of(null);
	}

	deleteCerf(id: string) {
		return this.http.delete&lt;Response&lt;boolean&gt;&gt;(HttpConfig.baseUrl + &quot;/events/&quot; + id);
	}




	// just a simple array of month-year objects
	getMrfList() {
		const current &#x3D; moment();
		const oldest &#x3D; moment().month() &gt; 5 ? moment().set(&#x27;month&#x27;, 5) : moment().subtract(1, &#x27;year&#x27;).set(&#x27;month&#x27;, 5);
		let list &#x3D; [];
		while ((current &gt; oldest || current.format(&#x27;M&#x27;) &#x3D;&#x3D;&#x3D; oldest.format(&#x27;M&#x27;)) &amp;&amp; list.length &lt; 13) {
			list.push({ month: current.format(&#x27;M&#x27;), year: current.format(&#x27;YYYY&#x27;) });
			current.subtract(1, &#x27;month&#x27;);
		}

		return of(list);
	}

	getMrfByDate(year: string, month: string) {
		return this.http.get&lt;Response&lt;Mrf&gt;&gt;(HttpConfig.baseUrl + &quot;/clubs/&quot; + this.user.club_id + &quot;/mrfs/&quot; + year + &quot;/&quot; + month);
	}

	updateMrf(data: Mrf) {
		if(!this.user) return of(null);
		console.log(data);
		return this.http.patch&lt;Response&lt;boolean&gt;&gt;(HttpConfig.baseUrl + &quot;/clubs/&quot; + this.user.club_id + &quot;/mrfs/&quot; + data.year + &quot;/&quot; + data.month, data);
	}



	// Option 1: RouterReuseStrategy
	// Option 2: directly save inputted data when routing (this is more predicatable and explicit?)
	setMrfState(component) {
		this.mrfState &#x3D; component.mrfForm.getRawValue();
		this.mrfFormState &#x3D; component.mrfForm;
		this.mrfTabState &#x3D; component.currentTab;
	}

	deleteMrfState() {
		this.mrfState &#x3D; undefined;
		this.mrfFormState &#x3D; undefined;
		this.mrfTabState &#x3D; undefined;
	}

	get getMrfTabState() {
		if(this.mrfTabState) {
			return this.mrfTabState;
		}
		return &quot;main&quot;;
	}

	get getMrfFormState() {
		if(this.mrfFormState)
			return this.mrfFormState;
	}



	fetchMembers() {
		if(!this.user) return of(null);
		return this.http.get&lt;any&gt;(HttpConfig.baseUrl + &quot;/clubs/&quot; + this.user.club_id + &quot;/members&quot;);
	}

	addMember(first: string, last: string) {
		if(!this.user) return of(false);
		return this.http.post(HttpConfig.baseUrl + &#x27;/clubs/&#x27; + this.user.club_id + &quot;/members&quot;, {name: {&#x27;first&#x27;: first, &#x27;last&#x27;: last}});
	}

	getMemberCode(id: string) {
		return this.http.get&lt;any&gt;(HttpConfig.baseUrl + &#x27;/members/&#x27; + id + &#x27;/registration&#x27;);
	}


	// Only usable by district secretary
	getDivisions() {
		return this.http.get(HttpConfig.baseUrl + &quot;/divisions&quot;);
	}

	newDivision(name: string) {
		return this.http.post(HttpConfig.baseUrl + &quot;/divisions&quot;, {&#x27;name&#x27;: name});
	}

	deleteDivision(id: string) {
		return this.http.delete(HttpConfig.baseUrl + &quot;/divisions/&quot; + id);
	}




	getClubs(divisionId?: string) {
		if(!this.user) return of(null);
		if(!divisionId) divisionId&#x3D;this.user.division_id;
		return this.http.get&lt;any&gt;(HttpConfig.baseUrl + &quot;/divisions/&quot; + divisionId + &quot;/clubs&quot;);
	}

	newClub(name: string) {
		if(!this.user) return of(false);
		return this.http.post(HttpConfig.baseUrl + &#x27;/divisions/&#x27; + this.user.division_id + &#x27;/clubs&#x27;, {&#x27;name&#x27;: name});
	}

	deleteClub(id: string) {
		return this.http.delete(HttpConfig.baseUrl + &#x27;/clubs/&#x27; + id);
	}
}</code></pre>
    </div>
</div>






                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'Response.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
